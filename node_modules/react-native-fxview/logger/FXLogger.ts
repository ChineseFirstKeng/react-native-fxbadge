/* eslint-disable @typescript-eslint/no-explicit-any */
// ========== Logger ç±»å‹å®šä¹‰ ==========

/**
 * æ—¥å¿—çº§åˆ«æšä¸¾
 */
export enum FXLogLevel {
  DEBUG = 0, // è°ƒè¯•çº§åˆ«ï¼ˆæœ€è¯¦ç»†ï¼‰
  INFO = 1, // ä¿¡æ¯çº§åˆ«
  WARN = 2, // è­¦å‘Šçº§åˆ«
  ERROR = 3, // é”™è¯¯çº§åˆ«
  SILENT = 4, // é™é»˜æ¨¡å¼ï¼ˆä¸è¾“å‡ºä»»ä½•æ—¥å¿—ï¼‰
}

/**
 * Logger é…ç½®æ¥å£
 */
export interface FXLoggerConfig {
  debug: boolean; // æ˜¯å¦å¯ç”¨è°ƒè¯•æ¨¡å¼
  level: FXLogLevel; // æ—¥å¿—çº§åˆ«
  showTimestamp: boolean; // æ˜¯å¦æ˜¾ç¤ºæ—¶é—´æˆ³
  prefix: string; // æ—¥å¿—å‰ç¼€
}

/**
 * FX Logger - ä¸“ä¸º React Native é¡¹ç›®è®¾è®¡çš„è°ƒè¯•æ—¥å¿—ç³»ç»Ÿ
 * æä¾›ä¸°å¯Œçš„æ—¥å¿—åŠŸèƒ½å’Œçµæ´»çš„é…ç½®é€‰é¡¹
 */
export class FXLogger {
  private static instance: FXLogger;
  private config: FXLoggerConfig;

  /**
   * ç§æœ‰æ„é€ å‡½æ•°ï¼Œå®ç°å•ä¾‹æ¨¡å¼
   */
  private constructor() {
    // è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ
    const isDevelopment = this.isDevelopmentEnvironment();

    // æ ¹æ®ç¯å¢ƒè®¾ç½®é»˜è®¤é…ç½®
    this.config = {
      debug: isDevelopment, // å¼€å‘ç¯å¢ƒå¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œç”Ÿäº§ç¯å¢ƒç¦ç”¨
      level: isDevelopment ? FXLogLevel.DEBUG : FXLogLevel.ERROR, // ç”Ÿäº§ç¯å¢ƒåªæ˜¾ç¤ºé”™è¯¯æ—¥å¿—
      showTimestamp: true,
      prefix: isDevelopment ? "[FX-DEV]" : "[FX-PROD]", // ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒå‰ç¼€
    };
  }

  /**
   * è·å–å•ä¾‹å®ä¾‹
   */
  public static getInstance(): FXLogger {
    if (!FXLogger.instance) {
      FXLogger.instance = new FXLogger();
    }
    return FXLogger.instance;
  }

  /**
   * æ£€æµ‹å½“å‰æ˜¯å¦ä¸ºå¼€å‘ç¯å¢ƒ
   */
  private isDevelopmentEnvironment(): boolean {
    try {
      // ä½¿ç”¨ Function æ„é€ å‡½æ•°æ¥å®‰å…¨åœ°è®¿é—®å…¨å±€å˜é‡ï¼Œé¿å… TypeScript é”™è¯¯
      const getGlobal = new Function("return this")();

      // æ£€æµ‹ React Native çš„ __DEV__ å˜é‡
      if (typeof getGlobal.__DEV__ !== "undefined" && getGlobal.__DEV__) {
        return true;
      }

      // æ£€æµ‹ Node.js ç¯å¢ƒå˜é‡
      if (
        typeof getGlobal.process !== "undefined" &&
        getGlobal.process.env &&
        getGlobal.process.env.NODE_ENV === "development"
      ) {
        return true;
      }

      // æ£€æµ‹ window å¯¹è±¡ï¼ˆæµè§ˆå™¨ç¯å¢ƒï¼‰
      if (typeof getGlobal.window !== "undefined" && getGlobal.window.__DEV__) {
        return true;
      }

      // æ£€æµ‹å…¨å±€å¯¹è±¡å±æ€§
      if (getGlobal.NODE_ENV === "development") {
        return true;
      }
    } catch (error) {
      // å¦‚æœæ£€æµ‹è¿‡ç¨‹ä¸­å‡ºé”™ï¼Œé»˜è®¤è¿”å› falseï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
      this.error("Environment detection failed", error);
    }

    // é»˜è®¤è¿”å› falseï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
    return false;
  }

  /**
   * è·å–å½“å‰é…ç½®
   */
  public getConfig(): FXLoggerConfig {
    return { ...this.config };
  }

  /**
   * é…ç½® Logger
   */
  public configure(config: Partial<FXLoggerConfig>): void {
    this.config = { ...this.config, ...config };
  }

  /**
   * å¯ç”¨è°ƒè¯•æ¨¡å¼
   */
  public enableDebug(): void {
    this.config.debug = true;
  }

  /**
   * ç¦ç”¨è°ƒè¯•æ¨¡å¼
   */
  public disableDebug(): void {
    this.config.debug = false;
  }

  /**
   * è·å–æ—¶é—´æˆ³ï¼ˆåŒ…å«å¹´æœˆæ—¥ï¼‰
   */
  private getTimestamp(): string {
    const now = new Date();
    const year = now.getFullYear();
    const month = (now.getMonth() + 1).toString().padStart(2, "0");
    const day = now.getDate().toString().padStart(2, "0");
    const hours = now.getHours().toString().padStart(2, "0");
    const minutes = now.getMinutes().toString().padStart(2, "0");
    const seconds = now.getSeconds().toString().padStart(2, "0");
    const milliseconds = now.getMilliseconds().toString().padStart(3, "0");
    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;
  }

  /**
   * æ£€æŸ¥æ˜¯å¦åº”è¯¥è®°å½•æ—¥å¿—
   */
  private shouldLog(level: FXLogLevel): boolean {
    if (!this.config.debug && level < FXLogLevel.ERROR) {
      return false;
    }
    return level >= this.config.level;
  }

  /**
   * è·å–æ—¥å¿—çº§åˆ«çš„é¢œè‰²ç¬¦å·
   */
  private getLevelColor(level: FXLogLevel): string {
    switch (level) {
      case FXLogLevel.DEBUG:
        return "ğŸ”µ"; // è“è‰² - è°ƒè¯•
      case FXLogLevel.INFO:
        return "ğŸŸ¢"; // ç»¿è‰² - ä¿¡æ¯
      case FXLogLevel.WARN:
        return "ğŸŸ¡"; // é»„è‰² - è­¦å‘Š
      case FXLogLevel.ERROR:
        return "ğŸ”´"; // çº¢è‰² - é”™è¯¯
      default:
        return "âšª"; // é»˜è®¤ç™½è‰²
    }
  }

  /**
   * æ ¼å¼åŒ–æ—¥å¿—æ¶ˆæ¯
   */
  private formatMessage(level: string, message: string): string {
    const parts: string[] = [];

    if (this.config.prefix) {
      parts.push(this.config.prefix);
    }

    if (this.config.showTimestamp) {
      parts.push(`[${this.getTimestamp()}]`);
    }

    // æ ¹æ®æ—¥å¿—çº§åˆ«æ·»åŠ é¢œè‰²ç¬¦å·
    const levelEnum =
      FXLogLevel[level.toUpperCase() as keyof typeof FXLogLevel];
    const colorSymbol = this.getLevelColor(levelEnum);
    parts.push(`[${colorSymbol}${level.toUpperCase()}]`);

    return parts.join("") + " " + message;
  }

  /**
   * è°ƒè¯•æ—¥å¿—
   */
  log(message?: any, ...optionalParams: any[]): void {
    if (!this.shouldLog(FXLogLevel.DEBUG)) return;

    const formattedMessage = this.formatMessage("debug", message);
    console.log(formattedMessage, ...optionalParams);
  }

  /**
   * ä¿¡æ¯æ—¥å¿—
   */
  info(message?: any, ...optionalParams: any[]): void {
    if (!this.shouldLog(FXLogLevel.INFO)) return;

    const formattedMessage = this.formatMessage("info", message);
    console.info(formattedMessage, ...optionalParams);
  }

  /**
   * è­¦å‘Šæ—¥å¿—
   */
  warn(message?: any, ...optionalParams: any[]): void {
    if (!this.shouldLog(FXLogLevel.WARN)) return;

    const formattedMessage = this.formatMessage("warn", message);
    console.warn(formattedMessage, ...optionalParams);
  }

  /**
   * é”™è¯¯æ—¥å¿—
   */
  error(message?: any, ...optionalParams: any[]): void {
    if (!this.shouldLog(FXLogLevel.ERROR)) return;

    const formattedMessage = this.formatMessage("error", message);
    console.error(formattedMessage, ...optionalParams);
  }

  /**
   * è¿½è¸ªæ—¥å¿—
   */
  trace(message?: any, ...optionalParams: any[]): void {
    if (!this.shouldLog(FXLogLevel.DEBUG)) return;

    const formattedMessage = this.formatMessage("trace", message);
    console.trace(formattedMessage, ...optionalParams);
  }

  /**
   * è¡¨æ ¼æ—¥å¿—
   */
  table(...data: any[]): void {
    if (!this.shouldLog(FXLogLevel.DEBUG)) return;

    console.table(...data);
  }

  /**
   * åˆ†ç»„æ—¥å¿—
   */
  group(label?: string): void {
    if (!this.shouldLog(FXLogLevel.DEBUG)) return;

    console.group(label);
  }

  /**
   * ç»“æŸåˆ†ç»„æ—¥å¿—
   */
  groupEnd(): void {
    console.groupEnd();
  }

  /**
   * æŠ˜å åˆ†ç»„æ—¥å¿—
   */
  groupCollapsed(label?: string): void {
    if (!this.shouldLog(FXLogLevel.DEBUG)) return;

    console.groupCollapsed(label);
  }
}

// åˆ›å»ºå…¨å±€å®ä¾‹
const logger = FXLogger.getInstance();

// å¯¼å‡ºé»˜è®¤å®ä¾‹
export default logger;
